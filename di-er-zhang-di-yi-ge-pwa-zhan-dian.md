
# 第一个 PWA 站点


通过第一章节的学习，大家已经对 PWA 的一些基础概念有所了解。它的诞生主要是希望能为 Web App 用户提供类似原生应用的体验，如主屏入口，全屏浏览，离线访问等等。本章节我们将带领大家完成一个基本的拥有 PWA 特性的站点，便于大家对后续章节开始深入的学习。

开始之前，我们首先思考的是我们可以在 Web App 的那几方面提升用户的体验，目前业内主要集中于以下几方面：

- 进人站点首页的白屏时间
- 站点拥有离线缓存，在断网或弱网情况下，依旧可以访问缓存页面
- 添加到主屏入口，点击后能够像原生应用一样拥有进场动画并全屏展示







## 2.1 App Shell 架构

该部分主要是为了减少页面的白屏时间，提升用户的交互体验。

### 2.1.1 什么是 App Shell ?

App Shell 架构，通俗的理解可以说是页面的架构，即页面的一个基本结构划分，如图 2-1 所示。从理论上讲，App Shell 是支持用户界面所需的最小的 HTML、CSS 和 JavaScript，如果能够将这些文件缓存在本地，并在用户重复访时即时、可靠地提供给用户，从而避免用户每次重新加载大量页面资源导致的长时间白屏。所以并不是每次用户访问时都要从网络加载 App Shell，而只需要从网络中加载必要的页面内容或数据等。

### 2.1.2 App Shell 划分?



### 2.1.3 App Shell 怎么开发?

App Shell 架构是构建 Progressive Web App 的一种方式，这种应用能可靠且即时地加载到您的用户屏幕上，与本机应用相似。

App“shell”是支持用户界面所需的最小的 HTML、CSS 和 JavaScript，如果离线缓存，可确保在用户重复访问时提供即时、可靠的良好性能。这意味着并不是每次用户访问时都要从网络加载 App Shell。 只需要从网络中加载必要的内容。

对于使用包含大量 JavaScript 的架构的单页应用来说，App Shell 是一种常用方法。这种方法依赖渐进式缓存 Shell（使用服务工作线程）让应用运行。接下来，为使用 JavaScript 的每个页面加载动态内容。App Shell 非常适合用于在没有网络的情况下将一些初始 HTML 快速加载到屏幕上

## 2.2 离线缓存

App Shell 的快速呈现，依赖于对部分文件的本地缓存，前面大家将站点 App Shell （用户界面所需最小的 HTML、CSS 和 JavaScript文件）的部分都开发完毕后，我们这里就要思考怎么将这些文件缓存在本地了。原本 HTML5 为 Web 应用专门提供了一个应用程序缓存机制方法 —— AppCache，但是由于该接口设计上存在一定的缺陷，未能普及开来，现在随时可能被停用删除，那取而代之的就是今天要隆重介绍的 Service Workers。它的出现让 Web 应用离线访问成为可能，让 Web 开发者们如获至宝，接下来我们尝试利用它来让站点实现离线缓存。

### 2.2.1 Service Worker

Service worker是一个注册在指定源和路径下的事件驱动 worker。它可以关联页面或者网站，拦截并修改访问和资源请求，细粒度地缓存资源，你可以根据不同的情形采用指定的缓存策略，让网站交互更友好。同时，出于网络安全的考虑，页面及网站请求都要求是 HTTPS 承载。在前面一个章节我们也简单介绍了相关的原理及生命周期，这里直接进入开发了


### 2.2.2 开发及常用的工具

service worker 需要经过注册，安装，激活才能接管指定的页面或网站，才能对接管页面及网站的请求进行拦截并处理。这里需要注意的是，Service Worker 只能拦截其注册文件所在目录及子目录下的页面的请求

- 原生写法

- sw-precache

- sw-toolbox

- workbox

### 2.2.3 SW 开发



## 2.3 添加桌面入口

借助 App Shell 及 Service Worker，我们的站点已经具备快速返回页面架构及一定的缓存能力，接下来我们会为网站赋予“可添加主屏幕”入口的能力（只针对移动端用户）。让用户能像访问一个原生 App 一样去访问站点页面。 

### 2.3.1 Manifest 配置

要想站点能够添加到手机主屏幕，需要三方面的考量：

- 站点根目录需新增一个 `Manifest.json`的文件，该文件中可配主屏幕入口的icon、入口地址、页面显示动画、名称、全屏等。

- 浏览器辅助提供添加到主屏的功能，如Chrome、手机百度、百度浏览器、小米、Safari 提供了相应的功能，可通过菜单或是弹屏提示引导用户添加主屏入口，相信随着 PWA 的普及，该功能会成为所有浏览器的一个重要的基础部分。

- 手机对浏览器开放`添加到主屏幕`的权限。不同手机或同一手机的不同系统版本可能配置上存在一定差异，调试前，大家需要对应的权限管理，允许弹屏提示及允许添加到桌面等设置，否则部分功能可能会被手机直接屏蔽而影响效果。

``` json
{
  "name": "Weather", // Web App 名称
  "short_name": "Weather",
  "icons": [{ // 主屏幕显示的入口icon图片，多个大小供适配选择
    "src": "images/icons/icon-128x128.png",
      "sizes": "128x128",
      "type": "image/png"
    }, {
      "src": "images/icons/icon-144x144.png",
      "sizes": "144x144",
      "type": "image/png"
    }, {
      "src": "images/icons/icon-152x152.png",
      "sizes": "152x152",
      "type": "image/png"
    }, {
      "src": "images/icons/icon-192x192.png",
      "sizes": "192x192",
      "type": "image/png"
    }, {
      "src": "images/icons/icon-256x256.png",
      "sizes": "256x256",
      "type": "image/png"
    }],
  "start_url": "/index.html", // 主屏幕入口的访问地址
  "display": "standalone", // 主屏幕入口的访问地址
  "background_color": "#3E4EB8", // 主屏幕入口动画背景色
  "theme_color": "#2F3BA2" // 手机顶部条的主题色
}

```

## 2.4 本书 DEMO

## 2.5 小结



